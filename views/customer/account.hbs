<section class="container--">
    <ul class="list-group account--list" id="list">
        <li class="list-group-item">
           <span class="list--label bg-primary">First Name</span>
            <a href="javascript:;" class="firstname text-secondary">{{user.firstName}}</a> 
        </li>
        <li class="list-group-item">
            <span class="list--label bg-primary">Last Name</span>
            <a href="javascript:;" class="lastname text-secondary">{{user.lastName}}</a> 
        </li>
        <li class="list-group-item">
            <span class="list--label bg-primary">Email</span>
            <a href="javascript:;" class="email text-secondary">{{user.email}}</a> 
        </li>
        <li class="list-group-item">
            <span class="list--label bg-primary">Password</span>
            <a href="javascript:;" class="password text-secondary">********</a> 
        </li>
    </ul>

    {{!-- First Name --}}
    <div class="account--dialog animate__faster" id="dialog">
        <div class="account--dialog__header">
            <a id="close" href="javascript:;" class="account--dialog__header--close fa fa-close fa-2x"></a>
        </div>
        <div class="account--dialog__content">
            <div class="flex-wrap" id="firstname" style="display: none;">
                <div class="form-group">
                    <label>First Name</label>
                    <input type="text" class="form-control firstname" value="{{user.firstName}}">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </div>
            <div class="flex-wrap" id="lastname" style="display: none;">
                <div class="form-group">
                    <label>Last Name</label>
                    <input type="text" class="form-control lastname" value="{{user.lastName}}">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </div>

            <div class="flex-wrap" id="email" style="display: none;">
                <div class="form-group">
                    <label>Email</label>
                    <input type="text" class="form-control email" value="{{user.email}}">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </div>

            <div class="flex-wrap" id="password" style="display: none;">
                <div class="form-group">
                    <label>Current password</label>
                    <input type="password" class="form-control current" value="">
                </div>
                <div class="form-group">
                    <label>New password</label>
                    <input type="password" class="form-control new" value="">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    $(function() {
        var $list = $('#list')
        var $dialog = $('#dialog')

        function showDialog(type) {
            $(`#${type}`).show().siblings().hide()
            $dialog.addClass('animate__animated animate__backInUp').show()
        }

        $list.on('click', 'a', function() {
            var $this = $(this)

            if ($this.hasClass('firstname')) {
                showDialog('firstname')
            } else if ($this.hasClass('lastname')) {
                showDialog('lastname')
            }  else if ($this.hasClass('email')) {
                showDialog('email')
            }  else if ($this.hasClass('password')) {
                showDialog('password')
            }
            
        })

        $('#firstname').on('click', 'button', function() {
            gbmsg.loading()
            var value = $('#firstname').find('input.firstname').val()
            $.ajax({
                url: '/customer/api/account/update',
                type: 'POST',
                data:{
                    type: 'firstName',
                    firstName: value
                }
            })
            .done(function() { 
                gbmsg.success('Success') 
                $dialog.hide()
                $list.find('a.firstname').text(value)
             })
            .fail(function(res) { 
                var resJson = res.responseJSON
                var errors = resJson.errors || []
                gbmsg.failure(errors[0] || "error"); 
            })
            .always(function() { 
                // gbmsg.hide()
             });
        })

        $('#lastname').on('click', 'button', function() {
            gbmsg.loading()
            var value = $('#lastname').find('input.lastname').val()
            $.ajax({
                url: '/customer/api/account/update',
                type: 'POST',
                data:{
                    type: 'lastName',
                    lastName: value
                }
            })
            .done(function() { 
                gbmsg.success('Success') 
                $dialog.hide()
                $list.find('a.lastname').text(value)
             })
            .fail(function(res) { 
                var resJson = res.responseJSON
                var errors = resJson.errors || []
                gbmsg.failure(errors[0] || "error"); 
            })
            .always(function() { 
                // gbmsg.hide()
             });
        })

        $('#email').on('click', 'button', function() {
            gbmsg.loading()
            var value = $('#email').find('input.email').val()
            $.ajax({
                url: '/customer/api/account/update',
                type: 'POST',
                data:{
                    type: 'email',
                    email: value
                }
            })
            .done(function() { 
                gbmsg.success('Success') 
                $dialog.hide()
                $list.find('a.email').text(value)
             })
            .fail(function(res) { 
                var resJson = res.responseJSON
                var errors = resJson.errors || []
                gbmsg.failure(errors[0] || "error"); 
            })
            .always(function() { 
                // gbmsg.hide()
             });
        })

        $('#password').on('click', 'button', function() {
            gbmsg.loading()
            var current = $('#password').find('input.current').val()
            var newVal = $('#password').find('input.new').val()
            var reg = /^(?=.*\d)(?=.*[.!@#$%^&*])(?=.*[a-z])(?=.*[A-Z])[a-zA-Z0-9!@#$%^&*]{8,20}$/

            if (!reg.test(current)) {
                gbmsg.failure('Current password does not meet the rules')
                return 
            }

            if (!reg.test(newVal)) {
                gbmsg.failure('New password does not meet the rules')
                return 
            }

            $.ajax({
                url: '/customer/api/account/update',
                type: 'POST',
                data:{
                    type: 'password',
                    oldPassword: current,
                    password: newVal,
                }
            })
            .done(function() { 
                gbmsg.success('Success') 
                $dialog.hide()


             })
            .fail(function(res) { 
                var resJson = res.responseJSON
                var errors = resJson.errors || []
                gbmsg.failure(errors[0] || "error"); 
            })
            .always(function() { 
                // gbmsg.hide()
             });
        })

        $('#close').click(function () {
            $dialog.hide()
        })
    })
</script>


















